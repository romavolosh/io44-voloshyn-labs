# ERD Проєкт

## **Топ найважчих рівнів у грі за думкою користувачів**

---

## 1. Короткий виклад вимог

### Мета системи

Система призначена для формування рейтингу **найскладніших рівнів у грі** на основі голосування користувачів.
Користувачі можуть оцінювати рівні, погоджуючись або не погоджуючись із тим, що рівень є складним.

---

### Потреби зацікавлених сторін

#### Гравці (користувачі)

* переглядати список рівнів
* бачити рейтинг складності
* голосувати (*Agree / Disagree*)
* змінювати свою думку (переголосування)

#### Модератор / Адміністратор

* додавати нові рівні
* модерувати рівні
* публікувати рівні у топі
* формувати рейтинг на основі голосів

---

### Дані, які необхідно зберігати

Система повинна зберігати:

* інформацію про користувачів
* інформацію про рівні
* інформацію про голосування користувачів

---

### Бізнес-правила

1. Один користувач може голосувати за один рівень **лише один раз**.
2. Користувач може або погодитись, або не погодитись (тільки один варіант).
3. Рівень з'являється у топі тільки якщо:

   * пройшов модерацію
   * позначений як public
4. Кількість Agreements та Disagreements **не зберігається**, а обчислюється на основі голосів.
5. Один рівень може мати багато голосів.
6. Один користувач може голосувати за багато рівнів.

---

## 2. ER-діаграма

ER-модель складається з трьох сутностей:

* **User**
* **Level**
* **Vote**

Зв’язок між User та Level є **багато-до-багатьох**, який реалізується через проміжну сутність **Vote**.

---

## 3. Сутності та атрибути

### Сутність: **User (Користувач)**

| Атрибут          | Опис                                 |
| ---------------- | ------------------------------------ |
| **user_id (PK)** | Унікальний ідентифікатор користувача |
| username         | Ім'я користувача                     |
| created_at       | Дата створення облікового запису     |

Користувач — це особа, яка може голосувати за рівні.

---

### Сутність: **Level (Рівень)**

| Атрибут           | Опис                           |
| ----------------- | ------------------------------ |
| **level_id (PK)** | Унікальний ідентифікатор рівня |
| name              | Назва рівня                    |
| placement         | Місце рівня у топі             |
| moderation        | Чи пройшов модерацію           |
| public            | Чи опублікований у топі        |

Рівень — це ігрова локація, складність якої оцінюють користувачі.

---

### Сутність: **Vote (Голос)**

| Атрибут          | Опис                                        |
| ---------------- | ------------------------------------------- |
| **vote_id (PK)** | Ідентифікатор голосу                        |
| user_id (FK)     | Користувач, який проголосував               |
| level_id (FK)    | Рівень, за який проголосували               |
| is_agree         | Тип голосу (true — agree, false — disagree) |
| voted_at         | Дата голосування                            |

Vote є **асоціативною (зв'язуючою) сутністю**, що реалізує голосування.

---

## 4. Пояснення зв'язків

### User — Vote

* Тип: **один-до-багатьох**
* Один користувач може залишити багато голосів
* Кожен голос належить тільки одному користувачу

### Level — Vote

* Тип: **один-до-багатьох**
* Один рівень може отримати багато голосів
* Кожен голос стосується лише одного рівня

### User — Level

* Тип: **багато-до-багатьох**
* Реалізується через таблицю Vote

---

## 5. Припущення та обмеження

1. Користувач може проголосувати за конкретний рівень тільки один раз
   (**обмеження UNIQUE(user_id, level_id)**).

2. Голос може бути лише двох типів:

   * agree
   * disagree

3. Agreements та Disagreements не зберігаються у Level, а обчислюються:

```
COUNT(is_agree = true)
COUNT(is_agree = false)
```

4. Рівень потрапляє в рейтинг тільки якщо:

   * moderation = true
   * public = true

5. Видалення користувача повинно видаляти його голоси (*cascade delete*).

6. Placement змінюється автоматично відповідно до кількості позитивних голосів.
